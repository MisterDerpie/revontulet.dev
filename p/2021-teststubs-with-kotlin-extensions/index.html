<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Utilizing Kotlin Extensions to create stubs for testing."><title>Teststubs with Kotlin Extensions</title><link rel=canonical href=https://revontulet.dev/p/2021-teststubs-with-kotlin-extensions/><link rel=stylesheet href=/scss/style.min.6a692fd055deae459f2a9767f57f3855ba80cafd5041317f24f7360f6ca47cdf.css><meta property='og:title' content="Teststubs with Kotlin Extensions"><meta property='og:description' content="Utilizing Kotlin Extensions to create stubs for testing."><meta property='og:url' content='https://revontulet.dev/p/2021-teststubs-with-kotlin-extensions/'><meta property='og:site_name' content='revontulet.dev by Matthias DÃ¶pmann'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='Software Engineering'><meta property='article:tag' content='Kotlin'><meta property='article:published_time' content='2021-06-25T22:00:00+00:00'><meta property='article:modified_time' content='2021-06-25T22:00:00+00:00'><meta name=twitter:title content="Teststubs with Kotlin Extensions"><meta name=twitter:description content="Utilizing Kotlin Extensions to create stubs for testing."><link rel="shortcut icon" href=/favicon.ico><meta author="Matthias DÃ¶pmann"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_1a8e49ce50b9ffbc.webp width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ðŸ‡«ðŸ‡®</span></figure><div class=site-meta><h1 class=site-name><a href=/>revontulet.dev by Matthias DÃ¶pmann</a></h1><h2 class=site-description>A blog about Software Engineering, from the arctic circle. And anything else.</h2></div></header><ol class=menu-social><li><a href=https://github.com/MisterDerpie target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://www.linkedin.com/in/matthias-doepmann/ target=_blank title=LinkedIn rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-linkedin"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M8 11v5"/><path d="M8 8v.01"/><path d="M12 16v-5"/><path d="M16 16v-3a2 2 0 10-4 0"/><path d="M3 7a4 4 0 014-4h10a4 4 0 014 4v10a4 4 0 01-4 4H7a4 4 0 01-4-4z"/></svg></a></li><li><a href=https://revontulet.dev/index.xml title=RSS rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-rss"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 19m-1 0a1 1 0 102 0 1 1 0 10-2 0"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/cv/><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-file-cv"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 3v4a1 1 0 001 1h4"/><path d="M17 21H7a2 2 0 01-2-2V5a2 2 0 012-2h7l5 5v11a2 2 0 01-2 2z"/><path d="M11 12.5a1.5 1.5.0 00-3 0v3a1.5 1.5.0 003 0"/><path d="M13 11l1.5 6 1.5-6"/></svg>
<span>About Me</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#problem-statement-in-java>Problem statement in Java</a><ol><li><a href=#test-utils-to-stub-classes>Test Utils to Stub Classes</a></li><li><a href=#test-code-meets-production-code>Test Code meets Production Code</a></li></ol></li><li><a href=#solution-in-kotlin>Solution in Kotlin</a><ol><li><a href=#setup>Setup</a></li><li><a href=#extend-customer>Extend Customer</a></li><li><a href=#test-agecheckservice-using-extension-stub>Test AgeCheckService using Extension Stub</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/software-engineering/ style=background-color:#2082a6;color:#fff>Software Engineering</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/2021-teststubs-with-kotlin-extensions/>Teststubs with Kotlin Extensions</a></h2><h3 class=article-subtitle>Utilizing Kotlin Extensions to create stubs for testing.</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Jun 25, 2021</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>5 minute read</time></div></footer></div></header><section class=article-content><p>The repository with the Kotlin code can be found on <a class=link href=https://github.com/MisterDerpie/kotlin-data-stubs target=_blank rel=noopener>github/MisterDerpie/kotlin-data-stubs</a>.</p><p>Currently I&rsquo;m having the great luck that our team started using Kotlin at work.
For that reason, I decided to learn Kotlin properly and started my journey with <a class=link href=https://www.manning.com/books/kotlin-in-action target=_blank rel=noopener>Kotlin in Action</a> (2017, Manning).
This is a bit outdated, considering that Kotlin 1.5 is the current release, but the vast majority of concepts are the same as for 1.0.</p><p>One concept that fascinates me and I really see a lot of value in is <a class=link href=https://kotlinlang.org/docs/extensions.html target=_blank rel=noopener>Extensions</a>.
Especially for tests I find that concept very useful, because it enables us to provide test related logic to our classes without actually adding this in the real production code.
Let&rsquo;s have a look at how we can utilize extensions to create stubs of business classes.</p><h2 id=problem-statement-in-java>Problem statement in Java</h2><h3 id=test-utils-to-stub-classes>Test Utils to Stub Classes</h3><p>A problem that often arises in Java projects is that you need to provide stubs for using e.g. the same customer in multiple tests.
Suppose you have a class <code>Customer.java</code> that looks like this</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@AllArgsConstructor</span><span class=w> </span><span class=cm>/* Generates constructor with all parameters */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nd>@Getter</span><span class=w> </span><span class=cm>/* Generates getters for all properties */</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Customer</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>UUID</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Integer</span><span class=w> </span><span class=n>age</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>and you would like to stub the same customer for your tests.
How would you do that?
Probably you create some class called <code>TestUtils.java</code>, that provides a static method <code>stubCustomer</code>.
In larger projects, you most likely have many different stubs in it, from Address over Customer to Shopping Cart.
Thus, you start adding all these stubs in the <code>TestUtils</code> class.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>TestUtils</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>Customer</span><span class=w> </span><span class=nf>stubCustomer</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>Address</span><span class=w> </span><span class=nf>stubAddress</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>I have seen such classes having hundreds of lines of code, with many different, totally unrelated objects.
A first attempt to improve that would be to create <code>TestUtilsCustomer.java</code>, <code>TestUtilsAddress.java</code>, &mldr;
That would leave us with a better, yet still not the best solution.</p><h3 id=test-code-meets-production-code>Test Code meets Production Code</h3><p>Wouldn&rsquo;t it be nice to provide <code>stubCustomer</code> directly in the <code>Customer</code> itself?
With Java, you would have to include such method in your production code.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@AllArgsConstructor</span><span class=w> </span><span class=cm>/* Generates constructor with all parameters */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=nd>@Getter</span><span class=w> </span><span class=cm>/* Generates getters for all properties */</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Customer</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>UUID</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Integer</span><span class=w> </span><span class=n>age</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>Customer</span><span class=w> </span><span class=nf>stubFullAgeCustomer</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Customer</span><span class=p>(</span><span class=n>UUID</span><span class=p>.</span><span class=na>randomUUID</span><span class=p>(),</span><span class=w> </span><span class=s>&#34;JavaName&#34;</span><span class=p>,</span><span class=w> </span><span class=n>18</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Testcode should never, <strong>never</strong> reside in production code.
With Kotlin, we can actually do that, but without production code ever knowing about this <code>stubFullAgeCustomer</code> method.</p><h2 id=solution-in-kotlin>Solution in Kotlin</h2><p>Before continue reading, think about why it would be nice to have a preconfigured Customer provided by the <code>Customer</code> object itself.
When implementing the <a class=link href=https://en.wikipedia.org/wiki/Builder_pattern target=_blank rel=noopener>Builder Pattern</a>, you configure each property by a callchain of functions with the properties&rsquo; names.
It could look like this <code>Customer.name("Builder").age(23).uuid(UUID.randomUUID()).build()</code>.
So why not getting a fully preset instance as part of this object, too?</p><p>This can be achieved in Kotlin.</p><h3 id=setup>Setup</h3><p>We define a <code>Customer</code> data class and an <code>AgeCheckService</code> (the latter is purely to have something to test, so that I can show how our extension works).</p><p><code>Customer.kt</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>package</span> <span class=nn>dto</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>import</span> <span class=nn>java.util.UUID</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>data</span> <span class=k>class</span> <span class=nc>Customer</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>id</span><span class=p>:</span> <span class=n>UUID</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>name</span><span class=p>:</span> <span class=n>String</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>age</span><span class=p>:</span> <span class=n>Int</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>companion</span> <span class=k>object</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>What enables us to extend the <code>Customer</code> with new &ldquo;static&rdquo; methods for our test is the <a class=link href=https://kotlinlang.org/docs/object-declarations.html#companion-objects target=_blank rel=noopener>companion object</a>.
As this is a pure data class, we don&rsquo;t add anything else.</p><p><code>AgeCheckService.kt</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>package</span> <span class=nn>service</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>import</span> <span class=nn>dto.Customer</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>AgeCheckService</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>companion</span> <span class=k>object</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>fun</span> <span class=nf>isCustomerOfFullAge</span><span class=p>(</span><span class=n>customer</span><span class=p>:</span> <span class=n>Customer</span><span class=p>):</span> <span class=n>Boolean</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>customer</span><span class=p>.</span><span class=n>age</span> <span class=o>&gt;=</span> <span class=mi>18</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>This services only functionality is to return <code>true</code> when the customer is of full age, and <code>false</code> when they&rsquo;re minor.
As initially stated, this is for the sole purpose of having something to test.</p><h3 id=extend-customer>Extend Customer</h3><p>In our test, we would like to call the following:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=nc>Customer</span><span class=p>.</span><span class=n>stubFullAgeCustomer</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nc>Customer</span><span class=p>.</span><span class=n>stubMinorAgeCustomer</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>to retrieve preconfigured customers with <em>some</em> age greater or equal than 18 or less than 18, respectively.
This is as easy as doing <a class=link href=https://kotlinlang.org/docs/extensions.html#companion-object-extensions target=_blank rel=noopener>companion object extensions</a>.</p><p>To do so, simply place a file in your testpath, and define the functions on <code>Customer.Companion</code>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>package</span> <span class=nn>dto</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>import</span> <span class=nn>java.util.UUID</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>fun</span> <span class=nf>Customer</span><span class=p>.</span><span class=nc>Companion</span><span class=p>.</span><span class=n>stubFullAgeCustomer</span><span class=p>():</span> <span class=n>Customer</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>Customer</span><span class=p>(</span><span class=nc>UUID</span><span class=p>.</span><span class=n>nameUUIDFromBytes</span><span class=p>(</span><span class=s2>&#34;This is some string for UUID&#34;</span><span class=p>.</span><span class=n>toByteArray</span><span class=p>()),</span> <span class=s2>&#34;MisterDerpie&#34;</span><span class=p>,</span> <span class=mi>24</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>fun</span> <span class=nf>Customer</span><span class=p>.</span><span class=nc>Companion</span><span class=p>.</span><span class=n>stubMinorAgeCustomer</span><span class=p>():</span> <span class=n>Customer</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>Customer</span><span class=p>(</span><span class=nc>UUID</span><span class=p>.</span><span class=n>nameUUIDFromBytes</span><span class=p>(</span><span class=s2>&#34;This is another UUID string&#34;</span><span class=p>.</span><span class=n>toByteArray</span><span class=p>()),</span> <span class=s2>&#34;MinorPerson&#34;</span><span class=p>,</span> <span class=mi>17</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Note that when you do not define a name for the companion object in the class, it will be accessible by <code>Companion</code>.
Congratulations, you just added extensions which you can use in your tests.</p><h3 id=test-agecheckservice-using-extension-stub>Test AgeCheckService using Extension Stub</h3><p>The last step is to import your Extensions into your test.
They are not automatically applied globally to your Customer, which is the reason why you explicitly have to import them.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>package</span> <span class=nn>service</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>import</span> <span class=nn>dto.Customer</span>
</span></span><span class=line><span class=cl><span class=k>import</span> <span class=nn>dto.stubFullAgeCustomer</span>
</span></span><span class=line><span class=cl><span class=k>import</span> <span class=nn>dto.stubMinorAgeCustomer</span>
</span></span><span class=line><span class=cl><span class=k>import</span> <span class=nn>org.junit.jupiter.api.Test</span>
</span></span><span class=line><span class=cl><span class=k>import</span> <span class=nn>org.assertj.core.api.Assertions.assertThat</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>AgeCheckServiceTest</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=k>fun</span> <span class=nf>`should return true when customer is of full age`</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>val</span> <span class=py>customer</span> <span class=p>=</span> <span class=nc>Customer</span><span class=p>.</span><span class=n>stubFullAgeCustomer</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>assertThat</span><span class=p>(</span><span class=nc>AgeCheckService</span><span class=p>.</span><span class=n>isCustomerOfFullAge</span><span class=p>(</span><span class=n>customer</span><span class=p>)).</span><span class=n>isEqualTo</span><span class=p>(</span><span class=k>true</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=k>fun</span> <span class=nf>`should return false when customer is of minor age`</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>val</span> <span class=py>customer</span> <span class=p>=</span> <span class=nc>Customer</span><span class=p>.</span><span class=n>stubMinorAgeCustomer</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>assertThat</span><span class=p>(</span><span class=nc>AgeCheckService</span><span class=p>.</span><span class=n>isCustomerOfFullAge</span><span class=p>(</span><span class=n>customer</span><span class=p>)).</span><span class=n>isEqualTo</span><span class=p>(</span><span class=k>false</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>See the imports at the top.
I placed the <code>Customer</code> in a package called <code>dto</code>.
The <code>stubFullAgeCustomer</code> and <code>stubMinorAgeCustomer</code> are also placed in a package called <code>dto</code> (but the name doesn&rsquo;t matter, it&rsquo;s just due to the same folder structure in the tests).
As stated initially, we need to import them to actually apply the extension to the <code>Customer</code>.</p><p>The tests are then straightforward: Get the customer and assert that the age service in fact returns <code>true</code> when they&rsquo;re of full age and <code>false</code> when they&rsquo;re of minor age.</p></section><footer class=article-footer><section class=article-tags><a href=/tags/software-engineering/>Software Engineering</a>
<a href=/tags/kotlin/>Kotlin</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/2021-generics-invariance-covariance-contravariance/><div class=article-details><h2 class=article-title>Generics - Invariance, Covariance and Contravariance</h2></div></a></article><article><a href=/p/2021-spring-boot-with-mongodb/><div class=article-details><h2 class=article-title>Spring Boot with MongoDB</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2025 -
2026 revontulet.dev by Matthias DÃ¶pmann</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "ab26ba39e87544c98ce4711525f9a8b8"}'></script></body></html>